<!doctype html>



  


<html class="theme-next pisces use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.1" />






<meta name="description" content="Nothing  is  impossible !">
<meta property="og:type" content="website">
<meta property="og:title" content="Big Elephant">
<meta property="og:url" content="http://yoursite.com/page/5/index.html">
<meta property="og:site_name" content="Big Elephant">
<meta property="og:description" content="Nothing  is  impossible !">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Big Elephant">
<meta name="twitter:description" content="Nothing  is  impossible !">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":0,"b2t":false,"scrollpercent":false},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/page/5/"/>





  <title>Big Elephant</title>
  














</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Big Elephant</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2015/08/27/事务保存点/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Cuidx">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Big Elephant">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2015/08/27/事务保存点/" itemprop="url">事务保存点</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2015-08-27T00:00:00+08:00">
                2015-08-27
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/事务/" itemprop="url" rel="index">
                    <span itemprop="name">事务</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="事务保存点"><a href="#事务保存点" class="headerlink" title="事务保存点"></a>事务保存点</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div></pre></td><td class="code"><pre><div class="line">保存点（了解）</div><div class="line"></div><div class="line"><span class="number">1</span>. jdbc3.0后，可以在事务中设置保存点</div><div class="line">  &gt; 可以回滚到保存点！不用再回滚到事务开始时的状态了！</div><div class="line">  &gt; 如果回滚到保存点，事务并未结束！</div><div class="line"><span class="number">2</span>. 保存点在Spring框架中大量应用，用来处理事务传播！</div><div class="line"></div><div class="line">开始事务</div><div class="line">a条语句</div><div class="line">设置保存点<span class="number">1</span></div><div class="line">b条语句</div><div class="line">设置保存点<span class="number">2</span></div><div class="line">c条语句</div><div class="line">回滚到保存点<span class="number">1</span>（回滚了b和c，但没有回滚a！a又没回滚，又没提交）</div><div class="line">需要回滚或提交</div><div class="line"></div><div class="line"><span class="number">3</span>. 保存点相关API</div><div class="line">  * 测试当前数据库是否支持保存点：<span class="keyword">boolean</span> b = con.getMetaData().supportsSavepoints();</div><div class="line">  * 设置保存点：Savepoint sp = con.setSavepoint();</div><div class="line">  * 回滚到保存点：con.rollback(sp);</div><div class="line"></div><div class="line"></div><div class="line">代码测试：</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestSavepoint</span> </span>&#123;</div><div class="line">    </div><div class="line">    <span class="meta">@Test</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span> <span class="keyword">throws</span> SQLException </span>&#123;</div><div class="line">        <span class="keyword">boolean</span> flag = JDBCUtils_v3.getConnection().getMetaData().supportsSavepoints();</div><div class="line">        System.out.println(flag);</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="meta">@Test</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test1</span><span class="params">()</span> </span>&#123;</div><div class="line">        Connection conn = <span class="keyword">null</span>;</div><div class="line">        PreparedStatement pstmt = <span class="keyword">null</span>;</div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            <span class="comment">// 1.获得连接</span></div><div class="line">            conn = JDBCUtils_v3.getConnection();</div><div class="line">            conn.setAutoCommit(<span class="keyword">false</span>);</div><div class="line">            <span class="comment">// 2.编写SQL</span></div><div class="line">            String sql = <span class="string">"update tbl_account set money=money-1000 where name='静静'"</span>;</div><div class="line">            Savepoint sp1 = conn.setSavepoint();</div><div class="line">            </div><div class="line">            String sql1 = <span class="string">"update tbl_account set money=money-1000 where name='静静'"</span>;</div><div class="line">            </div><div class="line">            <span class="comment">// 3.获得执行SQL语句对象(PreparedStatement)</span></div><div class="line">            pstmt = conn.prepareStatement(sql);</div><div class="line">            pstmt.executeUpdate();</div><div class="line">            </div><div class="line">            pstmt = conn.prepareStatement(sql1);</div><div class="line">            conn.rollback(sp1);</div><div class="line">            <span class="comment">// 4.执行删除操作</span></div><div class="line">            pstmt.executeUpdate();</div><div class="line">            conn.commit();</div><div class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</div><div class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(e);</div><div class="line">        &#125; <span class="keyword">finally</span> &#123;</div><div class="line">            <span class="comment">//6.释放资源</span></div><div class="line">            JDBCUtils_v3.release(conn, pstmt, <span class="keyword">null</span>);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">&#125;</div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2015/08/27/事务并发访问/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Cuidx">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Big Elephant">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2015/08/27/事务并发访问/" itemprop="url">事务并发访问</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2015-08-27T00:00:00+08:00">
                2015-08-27
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/事务/" itemprop="url" rel="index">
                    <span itemprop="name">事务</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="事务并发访问"><a href="#事务并发访问" class="headerlink" title="事务并发访问"></a>事务并发访问</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div></pre></td><td class="code"><pre><div class="line">事务并发访问读问题</div><div class="line">  * 脏读：读取到另一个事务未提交数据！！！</div><div class="line">  * 不可重复读：对同一数据两次读取前后不一致！！！因为在第二次读取之前另一个事务修改数据！</div><div class="line">  * 幻读（虚读）：对数据的统计两次不一致！！！因为在第二次统计时，另一个事务插入了一条记录！</div><div class="line"></div><div class="line">举例：</div><div class="line">	脏读 </div><div class="line">		事务1：张三给李四转账100元</div><div class="line">		事务2：李四查看自己的账户</div><div class="line">		</div><div class="line">		张三 900 李四 500</div><div class="line">             800      600</div><div class="line">			 900      500</div><div class="line"></div><div class="line">			t1：事务1：开始事务</div><div class="line">			t2：事务1：张三给李四转账100元 100</div><div class="line">			t3：事务2：开始事务</div><div class="line">			t4：事务2：李四查看自己的账户，看到账户多出100元（脏读）  600</div><div class="line">			t5：事务2：提交事务(李四查看自己多了100)</div><div class="line">			t6：事务1：回滚事务，回到转账之前的状态(张三实际没有转账成功)</div><div class="line"></div><div class="line"></div><div class="line">	不可重复读</div><div class="line">		事务1：酒店查看两次1048号房间状态</div><div class="line">		事务2：预订1048号房间</div><div class="line"></div><div class="line">			t1：事务1：开始事务</div><div class="line">			t2：事务1：查看1048号房间状态为空闲（第一次查询）</div><div class="line">			t3：事务2：开始事务</div><div class="line">			t4：事务2：预定1048号房间</div><div class="line">			t5：事务2：提交事务(1048房已经被预定了)</div><div class="line">			t6：事务1：再次查看1048号房间状态为使用（第二次查询）</div><div class="line">			t7：事务1：提交事务</div><div class="line">		对同一记录的两次查询结果不一致！</div><div class="line"></div><div class="line">	幻读</div><div class="line">		事务1：对酒店房间预订记录两次统计</div><div class="line">		事务2：添加一条预订房间记录</div><div class="line"></div><div class="line">			t1：事务1：开始事务</div><div class="line">			t2：事务1：统计预订记录100条</div><div class="line">			t3：事务2：开始事务</div><div class="line">			t4：事务2：添加一条预订房间记录</div><div class="line">			t5：事务2：提交事务</div><div class="line">			t6：事务1：再次统计预订记录为101记录</div><div class="line">			t7：事务1：提交</div><div class="line">		对同一表的两次查询不一致！</div><div class="line"></div><div class="line">不可重复读和幻读的区别：</div><div class="line">	不可重复读是读取到了另一事务的更新update；</div><div class="line">	幻读是读取到了另一事务的插入insert（MySQL中无法测试到幻读）；</div><div class="line"></div><div class="line">如何解决呢？(设置隔离级别)</div><div class="line"></div><div class="line">4个等级的事务隔离级别，在相同数据环境下，使用相同的输入，执行相同的工作，根据不同的隔离级别，可以导致不同的结果。不同事务隔离级别能够解决的数据并发问题的能力是不同的。</div><div class="line"></div><div class="line">1　SERIALIZABLE（串行化）</div><div class="line">	不会出现任何并发问题，因为它是对同一数据的访问是串行的，非并发访问的；</div><div class="line">	性能最差；</div><div class="line"></div><div class="line">2　REPEATABLE READ（可重复读）（MySQL）</div><div class="line">	防止脏读(读未提交)和不可重复读(读已修改)；</div><div class="line">	性能比SERIALIZABLE好</div><div class="line"></div><div class="line">3　READ COMMITTED（读已提交数据）（Oracle）</div><div class="line">	防止脏读(读未提交)；</div><div class="line">	性能比REPEATABLE READ好</div><div class="line"></div><div class="line">4　READ UNCOMMITTED（读未提交数据）</div><div class="line">	可能出现任何事务并发问题</div><div class="line">	性能最好</div><div class="line"></div><div class="line">如何解决这些问题的，查看图片</div><div class="line"></div><div class="line"></div><div class="line">设置隔离级别：set session transaction isolation level read uncommitted;</div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2015/08/27/事务特性/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Cuidx">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Big Elephant">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2015/08/27/事务特性/" itemprop="url">事务特性</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2015-08-27T00:00:00+08:00">
                2015-08-27
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/事务/" itemprop="url" rel="index">
                    <span itemprop="name">事务</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">事务</div><div class="line"></div><div class="line">1. 什么是事务</div><div class="line">  * 需要把多个操作绑定成一个事务（要么完全成功，要么完全失败）</div><div class="line"></div><div class="line">2. 事务的特性</div><div class="line">  * A 原子性：事务中的多条语句是不可再分隔的！要么完全成功，要么完全失败！</div><div class="line">  * C 一致性（核心）：在事务执行前后，要保证业务数据前后一致！</div><div class="line">  * I 隔离性：多个事务并发执行，需要隔离开来，保存不相互影响！</div><div class="line">  * D 持久性：数据只要保存到了数据库中，数据就是持久的！就算数据库马上崩溃，也要在重启后有能力恢复数据。</div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2015/08/27/事务隔离级别/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Cuidx">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Big Elephant">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2015/08/27/事务隔离级别/" itemprop="url">事务隔离级别</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2015-08-27T00:00:00+08:00">
                2015-08-27
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/事务/" itemprop="url" rel="index">
                    <span itemprop="name">事务</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="事务隔离级别"><a href="#事务隔离级别" class="headerlink" title="事务隔离级别"></a>事务隔离级别</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div></pre></td><td class="code"><pre><div class="line">1.7.3.1	演示脏读</div><div class="line">步骤一：分别开启两个窗口A,B:</div><div class="line">步骤二：分别查询两个窗口的隔离级别：</div><div class="line">* select @@tx_isolation;</div><div class="line">步骤三：设置A窗口的隔离级别为read uncommitted</div><div class="line">* set session transaction isolation level read uncommitted;</div><div class="line">步骤四：在两个窗口中分别开启事务：</div><div class="line">* start transaction;</div><div class="line">步骤五：在B窗口中转账操作：</div><div class="line">* update tbl_account set money = money - 1000 where name=&apos;书记&apos;;</div><div class="line">* update tbl_account set money = money + 1000 where name=&apos;科长&apos;;</div><div class="line">**** 在B窗口中没有提交事务的！！！</div><div class="line">步骤六：在A窗口中进行查询：</div><div class="line">* 已经转账成功!!!(脏读:一个事务中读到了另一个事务未提交的数据)</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">假设没有隔离级别：</div><div class="line">	那么这个里面的转账，A读到了B未提交的数据。此时存在脏读问题；</div><div class="line"></div><div class="line">解决这个问题：</div><div class="line">	提升隔离级别：设置为读已提交。那么B如果没有提交，那么A就不会读到未提交的数据，也就是最原始的数据。从而就解决了脏读问题！</div><div class="line"></div><div class="line"></div><div class="line">1.7.3.2	演示避免脏读，不可重复读发生</div><div class="line">步骤一：分别开启两个窗口A,B:</div><div class="line">步骤二：分别查询两个窗口的隔离级别：</div><div class="line">* select @@tx_isolation</div><div class="line">步骤三：设置A窗口的隔离级别为read committed;</div><div class="line">* set session transaction isolation level read committed;</div><div class="line">步骤四：在两个窗口中分别开启事务：</div><div class="line">* start transaction;</div><div class="line">步骤五：在B窗口中完成转账的操作：</div><div class="line">* update account set money = money - 1000 where name=&apos;守义&apos;;</div><div class="line">* update account set money = money + 1000 where name=&apos;凤儿&apos;;</div><div class="line">**** 在B窗口中没有提交事务！！！</div><div class="line">步骤六：在A窗口中进行查询：</div><div class="line">* 没有转账的结果！！！（已经避免了脏读）</div><div class="line">步骤七：在B窗口中提交事务！！！</div><div class="line">* commit;</div><div class="line">步骤八：在A窗口中进行查询：</div><div class="line">* 转账成功！！！（不可重复读：一个事务读到了另一个事务已经提交的update的数据，导致一次事务中多次查询结果不一致.）</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">1.7.3.3	演示避免不可重复读：</div><div class="line">步骤一：分别开启两个窗口A,B:</div><div class="line">步骤二：分别查询两个窗口的隔离级别：</div><div class="line">* select @@tx_isolation</div><div class="line">步骤三：设置A窗口的隔离级别为repeatable read;</div><div class="line">* set session transaction isolation level repeatable read;</div><div class="line">步骤四：在两个窗口中分别开始事务：</div><div class="line">* start transaction;</div><div class="line">步骤五：在B窗口中完成转账的操作：</div><div class="line">* update account set money = money - 1000 where name=&apos;守义&apos;;</div><div class="line">* update account set money = money + 1000 where name=&apos;凤儿&apos;;</div><div class="line">***** 在B窗口没有提交事务！！！</div><div class="line">步骤六：在A窗口中进行查询：</div><div class="line">* 没有转账成功！！！（已经避免脏读）</div><div class="line">步骤七：在B窗口提交事务！！！</div><div class="line">* commit;</div><div class="line">步骤八：在A窗口进行查询：</div><div class="line">* 转账没有成功！！（避免不可重复读）</div><div class="line">步骤九：在A窗口中结束事务,再重新查询.</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">1.7.3.4	演示隔离级别为serializable</div><div class="line">步骤一：分别开启两个窗口A,B:</div><div class="line">步骤二：分别查询两个窗口的隔离级别：</div><div class="line">* select @@tx_isolation</div><div class="line">步骤三：设置A窗口的隔离级别为serializable;</div><div class="line">* set session transaction isolation level serializable;</div><div class="line">步骤四：在两个窗口中分别开启事务：</div><div class="line">* start transaction;</div><div class="line">步骤五：在B窗口中完成一个insert操作:</div><div class="line">* insert into account values (null,&apos;芙蓉&apos;,10000);</div><div class="line">***** 事务没有提交！！</div><div class="line">步骤六：在A窗口中进行查找：</div><div class="line">* 没有任何结果！！！（不可以事务并发执行的）</div><div class="line">步骤七：在B窗口中结束事务！</div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2015/08/27/ThreadLocal本地线程/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Cuidx">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Big Elephant">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2015/08/27/ThreadLocal本地线程/" itemprop="url">ThreadLocal本地线程</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2015-08-27T00:00:00+08:00">
                2015-08-27
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/事务/" itemprop="url" rel="index">
                    <span itemprop="name">事务</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="ThreadLocal本地线程"><a href="#ThreadLocal本地线程" class="headerlink" title="ThreadLocal本地线程"></a>ThreadLocal本地线程</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div></pre></td><td class="code"><pre><div class="line">ThreadLocal</div><div class="line"></div><div class="line"><span class="number">1</span>. 线程本地变量</div><div class="line">  * ThreadLocal：每个线程都可以向其内保存数据，谁保存了，谁就可以获取到！没有保存，是获取不到的！</div><div class="line">    &gt; <span class="number">1</span>号线程，是否可以获取<span class="number">2</span>线程保存的数据？不能！！！</div><div class="line"></div><div class="line"><span class="number">2</span>. ThreadLocal内部是一个Map</div><div class="line">  * key：线程对象</div><div class="line">  * value：保存的数据</div><div class="line"></div><div class="line"></div><div class="line">  A线程中的代码：map.put(Thread.currentThread(), <span class="string">"hello"</span>);  map.get(Thread.currentThread());</div><div class="line">  B线程中的代码：map.put(Thread.currentThread(), <span class="string">"world"</span>);  map.get(Thread.currentThread());</div><div class="line"></div><div class="line"><span class="number">3</span>. ThreadLocal的API</div><div class="line">  * <span class="function"><span class="keyword">void</span> <span class="title">set</span><span class="params">(Object)</span> --&gt; 保存数据，底层在操作map，使用Thread.<span class="title">currentThread</span><span class="params">()</span></span></div><div class="line">  * Object <span class="title">get</span><span class="params">()</span> --&gt; 获取数据，底层在操作map，使用Thread.<span class="title">currentThread</span><span class="params">()</span></div><div class="line">  * <span class="keyword">void</span> <span class="title">remvoe</span><span class="params">()</span> --&gt; 移除数据，底层在操作map，使用Thread.<span class="title">currentThread</span><span class="params">()</span></div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">测试代码：</div><div class="line"><span class="keyword">public</span> class Demo2 &#123;</div><div class="line">	<span class="meta">@Test</span></div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">fun1</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</div><div class="line">		<span class="keyword">final</span> MyClass mc = <span class="keyword">new</span> MyClass();</div><div class="line">		mc.add(<span class="string">"zhangSan"</span>);<span class="comment">//1号保存zhangSan</span></div><div class="line">		Thread.sleep(<span class="number">1000</span>);</div><div class="line">		<span class="keyword">new</span> Thread() &#123;</div><div class="line">			<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</div><div class="line">				System.out.println(<span class="string">"2号："</span> + mc.get());<span class="comment">//2号获取值</span></div><div class="line">			&#125;</div><div class="line">		&#125;.start();</div><div class="line">		</div><div class="line">		System.out.println(<span class="string">"1号"</span> + mc.get());<span class="comment">//1号获取值</span></div><div class="line">	&#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyClass</span> </span>&#123;</div><div class="line">	<span class="keyword">private</span> ThreadLocal&lt;String&gt; tl = <span class="keyword">new</span> ThreadLocal&lt;String&gt;();</div><div class="line">	</div><div class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">add</span><span class="params">(String s )</span> </span>&#123;</div><div class="line">		tl.set(s);</div><div class="line">	&#125;</div><div class="line">	</div><div class="line">	<span class="function"><span class="keyword">public</span> String <span class="title">get</span><span class="params">()</span> </span>&#123;</div><div class="line">		<span class="keyword">return</span> tl.get();</div><div class="line">	&#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2015/08/27/Mysql事务操作/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Cuidx">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Big Elephant">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2015/08/27/Mysql事务操作/" itemprop="url">Mysql事务操作</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2015-08-27T00:00:00+08:00">
                2015-08-27
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/事务/" itemprop="url" rel="index">
                    <span itemprop="name">事务</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="MySQL事务操作"><a href="#MySQL事务操作" class="headerlink" title="MySQL事务操作"></a>MySQL事务操作</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">* 事务有两个边界！</div><div class="line">    &gt; 事务开始</div><div class="line">    &gt; 事务结束</div><div class="line">      * 成功</div><div class="line">      * 失败</div><div class="line">  * start transaction：开启事务</div><div class="line">    &gt; N条语句</div><div class="line">  * commit：成功！把N条语句提交了！</div><div class="line">  * rollback：失败！把N条语句回滚！回到事务开始时的状态！</div><div class="line"></div><div class="line">Mysql自动提交事务</div><div class="line">自动提交：</div><div class="line">	例如：执行了一句 UPDATE account SET money=money-<span class="number">1000</span> WHERE NAME=<span class="string">'小明'</span>;</div><div class="line">	底层其实执行了三句：</div><div class="line">	START TRANSACTION;--开启</div><div class="line">	UPDATE account SET money=money-<span class="number">1000</span> WHERE NAME=<span class="string">'小明'</span>;</div><div class="line">	COMMIT;--提交</div><div class="line"></div><div class="line"></div><div class="line">如果把自动提交关闭：</div><div class="line">	例如：执行了一句 UPDATE account SET money=money-<span class="number">1000</span> WHERE NAME=<span class="string">'小明'</span>;</div><div class="line">底层其实执行了两句：</div><div class="line">	START TRANSACTION;--开启</div><div class="line">	UPDATE account SET money=money-<span class="number">1000</span> WHERE NAME=<span class="string">'小明'</span>;</div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2015/08/27/JDBC中事务操作/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Cuidx">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Big Elephant">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2015/08/27/JDBC中事务操作/" itemprop="url">JDBC中事务操作</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2015-08-27T00:00:00+08:00">
                2015-08-27
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/事务/" itemprop="url" rel="index">
                    <span itemprop="name">事务</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="JDBC事务操作"><a href="#JDBC事务操作" class="headerlink" title="JDBC事务操作"></a>JDBC事务操作</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">  * 在JDBC中，所有与事务相关的操作，都是Connection的方法完成的！</div><div class="line">  * 开启事务：con.setAutoCommit(<span class="keyword">false</span>)</div><div class="line">    &gt; 默认情况下：所有的语句都是自动提交的，即一条语句一个事务！</div><div class="line">    &gt; 调用setAutoCommit(<span class="keyword">false</span>)，表示设置为手动提交！需要我们自己来写代码完成提交！</div><div class="line">  * 结束事务：</div><div class="line">    &gt; con.commit()：提交事务</div><div class="line">    &gt; con.rollback()：回滚事务</div><div class="line"></div><div class="line">事务的模板代码：</div><div class="line">  * <span class="keyword">try</span>项：开启事务</div><div class="line">  * <span class="keyword">try</span>底：提交事务</div><div class="line">  * <span class="keyword">catch</span>：回滚事务</div><div class="line">  </div><div class="line">  Connection con = <span class="keyword">null</span>;</div><div class="line">  PrearedStatement pstmt = <span class="keyword">null</span>;</div><div class="line">  <span class="keyword">try</span> &#123;</div><div class="line">      con = ...</div><div class="line">      con.setAutoCommit(<span class="keyword">false</span>);<span class="comment">//开始事物</span></div><div class="line"></div><div class="line">      pstmt = ...</div><div class="line">      </div><div class="line">      ...</div><div class="line"></div><div class="line">      con.commit();<span class="comment">//try块最后一句完成提交！</span></div><div class="line">  &#125; <span class="keyword">catch</span>(SQLException e) &#123;</div><div class="line">      con.rollback();<span class="comment">//在抛出异常后，完成回滚！</span></div><div class="line">  &#125; <span class="keyword">finally</span> &#123;</div><div class="line">    ...</div><div class="line">  &#125;</div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2015/08/27/DBUtils-事务操作/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Cuidx">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Big Elephant">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2015/08/27/DBUtils-事务操作/" itemprop="url">DBUtils 事务操作</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2015-08-27T00:00:00+08:00">
                2015-08-27
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/事务/" itemprop="url" rel="index">
                    <span itemprop="name">事务</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="DBUtils-事务操作"><a href="#DBUtils-事务操作" class="headerlink" title="DBUtils 事务操作"></a>DBUtils 事务操作</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line">DBUtils操作回顾(API)</div><div class="line">  * 创建QueryRunner</div><div class="line">    &gt; QueryRunner qr = new QueryRunner();</div><div class="line">      * 使用这个对象时，需要给它提供Connection</div><div class="line">    &gt; QueryRunner qr = new QueryRunner(dataSource);//需要连接池对象</div><div class="line">      * 使用这个对象时，不用给Connection</div><div class="line">  * 调用update()：</div><div class="line">    &gt; qr.update(connection, sql, array)</div><div class="line">      * connection：连接对象</div><div class="line">      * sql：sql模板，带有问号</div><div class="line">      * array：对应sql模板中问号的值！</div><div class="line">    &gt; qr.update(sql, array)</div><div class="line">      * sql：sql模板，带有问号</div><div class="line">      * array：对应sql模板中问号的值！</div><div class="line"></div><div class="line">  * 调用batch()</div><div class="line">    &gt; batch(Connection con, String sql, Object[][] params);</div><div class="line">    &gt; batch(String sql, Object[][] params);</div><div class="line"></div><div class="line">  * 调用query()</div><div class="line">    &gt; query(Connection con, String sql, ResultSetHandler rh, Object[] params);</div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2015/08/27/Mysql批处理/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Cuidx">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Big Elephant">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2015/08/27/Mysql批处理/" itemprop="url">Mysql批处理</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2015-08-27T00:00:00+08:00">
                2015-08-27
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/事务/" itemprop="url" rel="index">
                    <span itemprop="name">事务</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Mysql批处理"><a href="#Mysql批处理" class="headerlink" title="Mysql批处理"></a>Mysql批处理</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line">批处理</div><div class="line">  * 客户端可以把一堆的sql语句一次性发送给服务器，服务器执行所有sql语句。</div><div class="line">  * 批处理的实现步骤</div><div class="line">    &gt; Statement：可以理解为，它内部有一个集合，用来装载sql语句</div><div class="line">      * <span class="function"><span class="keyword">void</span> <span class="title">addBatch</span><span class="params">(String sql)</span>：添加sql语句到集合内！（没有执行！！！）</span></div><div class="line">      * <span class="keyword">int</span>[] <span class="title">executeBatch</span><span class="params">()</span>：执行集合中所有sql语句！</div><div class="line">      * <span class="keyword">void</span> <span class="title">clearBatch</span><span class="params">()</span>：清空集合中的sql语句！</div><div class="line">    &gt; PreparedStatement：（模板不能改变！批处理中执行的是相同的sql语句，只是参数不同！）</div><div class="line">      * <span class="keyword">void</span> <span class="title">addBatch</span><span class="params">()</span>：没有参数！在每个<span class="title">addBatch</span><span class="params">()</span>之前需要给参数赋值！</div><div class="line">        &gt; PreparedStatement内部的集合，装载的是N组参数！</div><div class="line"></div><div class="line">   * mysql默认是关闭批处理的！！！你想要开启，请先进行设置<span class="params">(设置一个变量，自己百度搜索)</span></div><div class="line"></div><div class="line">	如何演示：</div><div class="line">		代码跟之前一模一样</div><div class="line"></div><div class="line">	Connection conn = <span class="keyword">null</span>;</div><div class="line">	Statement stm = <span class="keyword">null</span>;</div><div class="line">	<span class="keyword">try</span>&#123;</div><div class="line">		conn = xxxx;</div><div class="line">		stm = conn.xxxx;</div><div class="line">		String sql = <span class="string">"insert into ^^^^^^"</span>;</div><div class="line">		<span class="keyword">for</span>(<span class="keyword">int</span> i=<span class="number">1</span>;i&lt;=<span class="number">1000000</span>;i++&#123;</div><div class="line">			stm.addBatch(sql);</div><div class="line">		&#125;</div><div class="line">		<span class="comment">//记录插入数据前的时间点</span></div><div class="line">		begin time1;</div><div class="line">		stm.executeBatch();</div><div class="line">		<span class="comment">//记录插入数据完成的时间点</span></div><div class="line">		end time2;	</div><div class="line">		syso(<span class="number">2</span>-<span class="number">1</span>);</div><div class="line">	&#125;<span class="keyword">catch</span>(……)&#123;</div><div class="line"></div><div class="line"></div><div class="line">	&#125;</div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2015/08/25/获取在线人数/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Cuidx">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/uploads/avatar.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Big Elephant">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2015/08/25/获取在线人数/" itemprop="url">获取在线人数</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2015-08-25T00:00:00+08:00">
                2015-08-25
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/js/" itemprop="url" rel="index">
                    <span itemprop="name">js</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <ul>
<li>主要的思路是：每当用户第一次访问web应用的时候都会创建一个session来跟踪会话，可以监听session的变化来记录当前在线的人数。每当创建session的时候，人数+1，当session销毁的时候，人数减1（在application（servletContext）添加一个属性来保存人数）。这样一来可以创建一个session监听器，监听session的变化就可以获得当前的人数。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">package</span> com.tuxianchao.listener;</div><div class="line"></div><div class="line"><span class="keyword">import</span> javax.servlet.ServletContext;</div><div class="line"></div><div class="line"><span class="keyword">import</span> javax.servlet.http.HttpSessionEvent;</div><div class="line"></div><div class="line"><span class="keyword">import</span> javax.servlet.http.HttpSessionListener;</div><div class="line"></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OnlineNumberListener</span> <span class="keyword">implements</span> <span class="title">HttpSessionListener</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sessionCreated</span><span class="params">(HttpSessionEvent sessionEvent)</span> </span>&#123;</div><div class="line">        System.out.println(<span class="string">"创建session，人数加1"</span>);</div><div class="line">        <span class="comment">// 获取servletcontext</span></div><div class="line">        ServletContext context = sessionEvent.getSession().getServletContext();</div><div class="line">        <span class="comment">// 获取当前人数</span></div><div class="line">        Integer count = (Integer) context.getAttribute(<span class="string">"OnlineCount"</span>);</div><div class="line">        <span class="keyword">if</span> (count == <span class="keyword">null</span>) &#123;</div><div class="line">            <span class="comment">// 若果为空，初始化为1（第一个访问的用户）</span></div><div class="line">            count = <span class="keyword">new</span> Integer(<span class="number">1</span>);</div><div class="line">        &#125; <span class="keyword">else</span> &#123;</div><div class="line">            <span class="comment">// +1</span></div><div class="line">            <span class="keyword">int</span> i = count.intValue();</div><div class="line">            count = <span class="keyword">new</span> Integer(i + <span class="number">1</span>);</div><div class="line">        &#125;</div><div class="line">        <span class="comment">// 改变人数</span></div><div class="line">        context.setAttribute(<span class="string">"OnlineCount"</span>, count);</div><div class="line">    &#125;</div><div class="line">    </div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sessionDestroyed</span><span class="params">(HttpSessionEvent sessionEvent)</span> </span>&#123;</div><div class="line">        System.out.println(<span class="string">"销毁session，人数减1"</span>);</div><div class="line">        ServletContext context = sessionEvent.getSession().getServletContext();</div><div class="line">        Integer count = (Integer) context.getAttribute(<span class="string">"OnlineCount"</span>);</div><div class="line">        <span class="keyword">int</span> i = count.intValue();</div><div class="line">        count = <span class="keyword">new</span> Integer(i - <span class="number">1</span>);</div><div class="line">        context.setAttribute(<span class="string">"OnlineCount"</span>, count);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>index.jsp</li>
</ul>
<figure class="highlight"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line">&lt;%@ page language="java" contentType="text/html; charset=ISO-8859-1"</div><div class="line"></div><div class="line">    pageEncoding="ISO-8859-1"%&gt;</div><div class="line"></div><div class="line">&lt;!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd"&gt;</div><div class="line"></div><div class="line">&lt;html&gt;</div><div class="line"></div><div class="line">&lt;head&gt;</div><div class="line"></div><div class="line">&lt;meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1"&gt;</div><div class="line"></div><div class="line">&lt;title&gt;Insert title here&lt;/title&gt;</div><div class="line"></div><div class="line">&lt;/head&gt;</div><div class="line"></div><div class="line">&lt;body&gt;</div><div class="line"></div><div class="line">    &lt;h1&gt;Index&lt;/h1&gt;</div><div class="line">    &lt;h4&gt;</div><div class="line">        Online:&lt;%=application.getAttribute("OnlineCount")%&gt;&lt;/h4&gt;</div><div class="line"></div><div class="line">&lt;/body&gt;</div><div class="line"></div><div class="line">&lt;/html&gt;</div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/4/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/4/">4</a><span class="page-number current">5</span><a class="page-number" href="/page/6/">6</a><a class="page-number" href="/page/7/">7</a><a class="extend next" rel="next" href="/page/6/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/uploads/avatar.jpg"
               alt="Cuidx" />
          <p class="site-author-name" itemprop="name">Cuidx</p>
           
              <p class="site-description motion-element" itemprop="description">Nothing  is  impossible !</p>
          
        </div>
        <nav class="site-state motion-element">

          
            <div class="site-state-item site-state-posts">
              <a href="/archives/">
                <span class="site-state-item-count">62</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          
            
            
            <div class="site-state-item site-state-categories">
              <a href="/categories/index.html">
                <span class="site-state-item-count">15</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

        


      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Cuidx</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Pisces
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.1"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.1"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.1"></script>



  
    <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.1"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.1"></script>

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.1"></script>



  


  




	





  





  





  






  





  

  

  

  

  

  

</body>
</html>
